{% extends "users/base.html" %}
{% load static %}

{% block title %}Listar Grupos{% endblock %}

{% block content %}
<style>
    /* Estilos específicos para a lista de grupos */
    .listar-grupos {
        background-color: #f8f9fa; /* Cor de fundo suave */
        border-radius: 0.5rem; /* Bordas arredondadas */
        padding: 2rem; /* Espaçamento interno */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Sombra leve */
    }

    .listar-grupos h2 {
        color: #4b8b3b; /* Cor do título */
        margin-bottom: 1.5rem; /* Margem inferior */
        text-align: center; /* Centraliza o texto */
    }

    .listar-grupos .table {
        background-color: #ffffff; /* Fundo branco para a tabela */
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1); /* Sombra leve */
    }

    .listar-grupos .table th {
        background-color: #4b8b3b; /* Cabeçalho verde */
        color: #ffffff; /* Texto branco */
    }

    .listar-grupos .table tbody tr:hover {
        background-color: #f1f1f1; /* Efeito hover */
    }

    .listar-grupos .btn {
        margin-right: 0.5rem; /* Espaçamento entre botões */
    }
</style>

<div class="container mt-4 listar-grupos">
    <h2>Listar Grupos</h2>
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#createGroupModal">Criar Novo Grupo</button>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for group in groups %}
            <tr>
                <td>{{ group.name }}</td>
                <td>
                    <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editGroupModal" data-group-id="{{ group.id }}" data-group-name="{{ group.name }}">Editar</button>
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteGroupModal" data-group-id="{{ group.id }}" data-group-name="{{ group.name }}">Excluir</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal Criar Grupo -->
<div class="modal fade" id="createGroupModal" tabindex="-1" aria-labelledby="createGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createGroupModalLabel">Criar Novo Grupo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createGroupForm" method="post" action="{% url 'create_group' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="groupName" class="form-label">Nome do Grupo</label>
                        <input type="text" class="form-control" id="groupName" name="name" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Criar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Editar Grupo -->
<div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editGroupModalLabel">Editar Grupo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editGroupForm" method="post" action="{% url 'edit_group' 0 %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="editGroupName" class="form-label">Nome do Grupo</label>
                        <input type="text" class="form-control" id="editGroupName" name="name" required>
                    </div>
                    <input type="hidden" id="editGroupId" name="id">
                    <button type="submit" class="btn btn-warning">Salvar Alterações</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Excluir Grupo -->
<div class="modal fade" id="deleteGroupModal" tabindex="-1" aria-labelledby="deleteGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteGroupModalLabel">Excluir Grupo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir o grupo <strong id="deleteGroupName"></strong>?</p>
            </div>
            <div class="modal-footer">
                <form id="deleteGroupForm" method="post" action="{% url 'delete_group' 0 %}">
                    {% csrf_token %}
                    <input type="hidden" id="deleteGroupId" name="id">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Preencher os campos do modal de edição
    document.getElementById('editGroupModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Botão que acionou o modal
        var groupId = button.getAttribute('data-group-id');
        var groupName = button.getAttribute('data-group-name');

        // Atualizar o campo do nome e ID
        document.getElementById('editGroupName').value = groupName;
        document.getElementById('editGroupId').value = groupId;

        // Atualiza a ação do formulário
        this.querySelector('form').action = "{% url 'edit_group' 0 %}".replace('0', groupId);
    });

    // Preencher os campos do modal de exclusão
    document.getElementById('deleteGroupModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget; // Botão que acionou o modal
        var groupId = button.getAttribute('data-group-id');
        var groupName = button.getAttribute('data-group-name');

        // Atualizar o nome do grupo que será excluído
        document.getElementById('deleteGroupName').textContent = groupName;

        // Atualiza a ação do formulário
        this.querySelector('form').action = "{% url 'delete_group' 0 %}".replace('0', groupId);
    });
</script>
{% endblock %}
